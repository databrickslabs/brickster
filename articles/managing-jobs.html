<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Job Management • brickster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Job Management">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">brickster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cluster-management.html">Cluster Management</a></li>
    <li><a class="dropdown-item" href="../articles/managing-jobs.html">Job Management</a></li>
    <li><a class="dropdown-item" href="../articles/remote-repl.html">Databricks REPL</a></li>
    <li><a class="dropdown-item" href="../articles/setup-auth.html">Connect to a Databricks Workspace</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/databrickslabs/brickster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Job Management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/databrickslabs/brickster/blob/main/vignettes/managing-jobs.Rmd" class="external-link"><code>vignettes/managing-jobs.Rmd</code></a></small>
      <div class="d-none name"><code>managing-jobs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="managing-databricks-jobs">Managing Databricks Jobs<a class="anchor" aria-label="anchor" href="#managing-databricks-jobs"></a>
</h2>
<p><a href="https://github.com/databrickslabs/brickster" class="external-link">brickster</a> provides coverage of the Jobs REST API’s,
allowing creation of multi-task jobs via R code.</p>
<div class="section level3">
<h3 id="job-basics">Job Basics<a class="anchor" aria-label="anchor" href="#job-basics"></a>
</h3>
<p>When listing the jobs the default behaviour is to returns the first
25 jobs, to configure the number of jobs returned you can specify
<code>limit</code> and <code>offset</code>.</p>
<p>The <code>expand_tasks</code> parameter will return task and cluster
details for each job (default <code>FALSE)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># list all jobs within Databricks workspace</span></span>
<span><span class="co"># can control limit, offset, and if cluster/jobs details are returned</span></span>
<span><span class="va">jobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_list.html">db_jobs_list</a></span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list all runs within a specific job</span></span>
<span><span class="va">job_runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">jobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span></code></pre></div>
<p>To return the details of a specific job you can use
<code><a href="../reference/db_jobs_get.html">db_jobs_get()</a></code>, this requires knowledge of the
<code>job_id</code> which can be found via the user interface in
Databricks or using <code><a href="../reference/db_jobs_list.html">db_jobs_list()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># details of a specific job</span></span>
<span><span class="va">job_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_get.html">db_jobs_get</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">jobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span></code></pre></div>
<p>Each job has one or more tasks which may have dependence upon each
other, execution of a job will flow through these tasks - this is known
as a “run” of a job. Jobs can be scheduled to start a run on a
particular schedule, or by a direct trigger such as
<code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code>.</p>
<p>There are a number of functions that are specific to job runs
execution and metadata:</p>
<table class="table">
<colgroup>
<col width="59%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th align="right">Purpose</th>
<th align="center">Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">Trigger new run of an existing job</td>
<td align="center"><code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code></td>
</tr>
<tr class="even">
<td align="right">List runs of a job</td>
<td align="center"><code><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Retrieve metadata for a specific job run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_get.html">db_jobs_runs_get()</a></code></td>
</tr>
<tr class="even">
<td align="right">Retrieve metadata for a specific task run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_get_output.html">db_jobs_runs_get_output()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Export code and/or dashboard for task run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_export.html">db_jobs_runs_export()</a></code></td>
</tr>
<tr class="even">
<td align="right">Delete record of a job run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_delete.html">db_jobs_runs_delete()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Cancel run of a job</td>
<td align="center"><code><a href="../reference/db_jobs_runs_cancel.html">db_jobs_runs_cancel()</a></code></td>
</tr>
</tbody>
</table>
<p>When using functions such as <code>db_jobs_run_get_output()</code>
and <code><a href="../reference/db_jobs_runs_export.html">db_jobs_runs_export()</a></code> the required <code>run_id</code>
can refer to the id of a given task. Each task within a given “run” will
also have a <code>run_id</code> that can be referenced.</p>
</div>
<div class="section level3">
<h3 id="creating-jobs">Creating Jobs<a class="anchor" aria-label="anchor" href="#creating-jobs"></a>
</h3>
<p><a href="https://github.com/databrickslabs/brickster" class="external-link">brickster</a> enables creation of jobs from R, these jobs
can be simple single task jobs or complex multi-task jobs with
dependencies that share and re-use clusters.</p>
<div class="section level4">
<h4 id="simple-job">Simple Job<a class="anchor" aria-label="anchor" href="#simple-job"></a>
</h4>
<p>A single-task job can be created with the following components:</p>
<ul>
<li><p><code><a href="../reference/job_task.html">job_task()</a></code> which defines a singular task</p></li>
<li><p><code><a href="../reference/new_cluster.html">new_cluster()</a></code> required by <code><a href="../reference/job_task.html">job_task()</a></code>,
it defines the compute specifications</p></li>
<li><p><code>*_task()</code>, one of the task functions
e.g. <code><a href="../reference/notebook_task.html">notebook_task()</a></code></p></li>
</ul>
<p>Below is the creation of a simple job that runs a notebook and has a
paused schedule:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a job task</span></span>
<span><span class="va">simple_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"simple_task"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"a simple task that runs a notebook"</span>,</span>
<span>  <span class="co"># specify a cluster for the job</span></span>
<span>  new_cluster <span class="op">=</span> <span class="fu"><a href="../reference/new_cluster.html">new_cluster</a></span><span class="op">(</span></span>
<span>    spark_version <span class="op">=</span> <span class="st">"16.4.x-scala2.12"</span>,</span>
<span>    driver_node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>    node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>    num_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    cloud_attr <span class="op">=</span> <span class="fu"><a href="../reference/aws_attributes.html">aws_attributes</a></span><span class="op">(</span>ebs_volume_size <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># this task will be a notebook</span></span>
<span>  task <span class="op">=</span> <span class="fu"><a href="../reference/notebook_task.html">notebook_task</a></span><span class="op">(</span>notebook_path <span class="op">=</span> <span class="st">"/brickster/simple-notebook"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create job with simple task</span></span>
<span><span class="va">simple_task_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"brickster example: simple"</span>,</span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">simple_task</span><span class="op">)</span>,</span>
<span>  <span class="co"># 9am every day, paused currently</span></span>
<span>  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span></span>
<span>    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,</span>
<span>    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multiple-tasks">Multiple Tasks<a class="anchor" aria-label="anchor" href="#multiple-tasks"></a>
</h4>
<p>Jobs can be extended beyond a singular task, this next example
extends the simple job example by now having three tasks. Each
subsequent task depends on the priors completion before it can proceed,
each task also will define its own <code>new_cluster</code>.</p>
<p>Whilst this job runs the same notebook each time for the sake of
example it demonstrates how to build dependencies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># one cluster definition, repeatedly use for each task</span></span>
<span><span class="va">multitask_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_cluster.html">new_cluster</a></span><span class="op">(</span></span>
<span>  spark_version <span class="op">=</span> <span class="st">"16.4.x-scala2.12"</span>,</span>
<span>  driver_node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>  node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>  num_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cloud_attr <span class="op">=</span> <span class="fu"><a href="../reference/aws_attributes.html">aws_attributes</a></span><span class="op">(</span>ebs_volume_size <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># each task will run the same notebook (just for this example)</span></span>
<span><span class="va">multitask_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/notebook_task.html">notebook_task</a></span><span class="op">(</span>notebook_path <span class="op">=</span> <span class="st">"/brickster/simple-notebook"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create three simple tasks that will depend on each other</span></span>
<span><span class="co"># task_a -&gt; task_b -&gt; task_c</span></span>
<span><span class="va">task_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_a"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"First task in the sequence"</span>,</span>
<span>  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_b"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Second task in the sequence"</span>,</span>
<span>  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span>,</span>
<span>  depends_on <span class="op">=</span> <span class="st">"task_a"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_c"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Third task in the sequence"</span>,</span>
<span>  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span>,</span>
<span>  depends_on <span class="op">=</span> <span class="st">"task_b"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create job with multiple tasks</span></span>
<span><span class="va">multitask_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"brickster example: multi-task"</span>,</span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">task_a</span>, <span class="va">task_b</span>, <span class="va">task_c</span><span class="op">)</span>,</span>
<span>  <span class="co"># 9am every day, paused currently</span></span>
<span>  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span></span>
<span>    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,</span>
<span>    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cluster-reuse">Cluster Reuse<a class="anchor" aria-label="anchor" href="#cluster-reuse"></a>
</h4>
<p>The multiple tasks example has one shortcoming - clusters are not
reused between tasks and therefore each task will have to wait for
another cluster to be started before its computations can begin, this
will typically add a few minutes to each task.</p>
<p>It can be advantageous to reuse clusters between job tasks to avoid
overhead for short lived tasks, or to share resources for tasks which
are not computationally demanding.</p>
<p>This example is the same as the previous multi-task job however it
now shares a single cluster for each task.</p>
<p><code>new_cluster</code> is replaced with
<code>job_cluster_key</code> in each task:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create three simple tasks that will depend on each other</span></span>
<span><span class="co"># this time we will use a shared cluster to reduce startup overhead</span></span>
<span><span class="co"># task_a -&gt; task_b -&gt; task_c</span></span>
<span><span class="va">task_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_a"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"First task in the sequence"</span>,</span>
<span>  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_b"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Second task in the sequence"</span>,</span>
<span>  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span>,</span>
<span>  depends_on <span class="op">=</span> <span class="st">"task_a"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">task_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"task_c"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Third task in the sequence"</span>,</span>
<span>  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,</span>
<span>  task <span class="op">=</span> <span class="va">multitask_task</span>,</span>
<span>  depends_on <span class="op">=</span> <span class="st">"task_b"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>job_clusters</code> is now defined in the
<code><a href="../reference/db_jobs_create.html">db_jobs_create()</a></code> call where it accepts a named list of
<code>new_clusters()</code>, we will reuse our example from earlier:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define job_clusters as a named list of new_cluster()</span></span>
<span><span class="va">multitask_job_with_reuse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"brickster example: multi-task with reuse"</span>,</span>
<span>  job_clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"shared_cluster"</span> <span class="op">=</span> <span class="va">multitask_cluster</span><span class="op">)</span>,</span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">task_a</span>, <span class="va">task_b</span>, <span class="va">task_c</span><span class="op">)</span>,</span>
<span>  <span class="co"># 9am every day, paused currently</span></span>
<span>  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span></span>
<span>    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,</span>
<span>    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>There can be multiple shared clusters and it may be beneficial to
give some demanding tasks a larger cluster alone (or to share with other
demanding tasks).</p>
</div>
<div class="section level4">
<h4 id="one-off-jobs">One-off Jobs<a class="anchor" aria-label="anchor" href="#one-off-jobs"></a>
</h4>
<p>It’s possible to create one-off jobs that do not have a schedule and
only appears under the “jobs runs” tab, not “jobs”.
<code><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit()</a></code> permits the use of an
<code>idempotency_token</code> which can avoid re-submission of a
run.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># submit a one off job run</span></span>
<span><span class="co"># reuse the simple task from first example</span></span>
<span><span class="co"># idempotency_token guarentees no additional triggers</span></span>
<span><span class="va">oneoff_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit</a></span><span class="op">(</span></span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">simple_task</span><span class="op">)</span>,</span>
<span>  run_name <span class="op">=</span> <span class="st">"brickster example: one-off job"</span>,</span>
<span>  idempotency_token <span class="op">=</span> <span class="st">"my_job_run_token"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="remote-git-repos">Remote Git Repos<a class="anchor" aria-label="anchor" href="#remote-git-repos"></a>
</h4>
<p>Instead of using notebooks contained within the Databricks workspace
a job can be referenced in an external git repository and reference a
specific branch, tag, or commit.</p>
<p>Let’s revisit the simple job example from before and adjust to use
<code><a href="../reference/git_source.html">git_source()</a></code>.<br>
In this example the repo will have a folder <code>example</code> which
contains <code>simple-notebook.py</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a job task</span></span>
<span><span class="co"># this time, the notebook_path is relative to the git root directory</span></span>
<span><span class="co"># omit file extensions like .py or .r</span></span>
<span><span class="va">simple_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span></span>
<span>  task_key <span class="op">=</span> <span class="st">"simple_task"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"a simple task that runs a notebook"</span>,</span>
<span>  <span class="co"># specify a cluster for the job</span></span>
<span>  new_cluster <span class="op">=</span> <span class="fu"><a href="../reference/new_cluster.html">new_cluster</a></span><span class="op">(</span></span>
<span>    spark_version <span class="op">=</span> <span class="st">"16.4.x-scala2.12"</span>,</span>
<span>    driver_node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>    node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,</span>
<span>    num_workers <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    cloud_attr <span class="op">=</span> <span class="fu"><a href="../reference/aws_attributes.html">aws_attributes</a></span><span class="op">(</span>ebs_volume_size <span class="op">=</span> <span class="fl">32</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># this task will be a notebook</span></span>
<span>  task <span class="op">=</span> <span class="fu"><a href="../reference/notebook_task.html">notebook_task</a></span><span class="op">(</span>notebook_path <span class="op">=</span> <span class="st">"example/simple-notebook"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Within the call to <code><a href="../reference/db_jobs_create.html">db_jobs_create()</a></code> use
<code><a href="../reference/git_source.html">git_source()</a></code> to point to the repo containing the
notebook.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create job with simple task</span></span>
<span><span class="va">simple_task_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"brickster example: simple"</span>,</span>
<span>  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">simple_task</span><span class="op">)</span>,</span>
<span>  <span class="co"># git source points to repo</span></span>
<span>  git_source <span class="op">=</span> <span class="fu"><a href="../reference/git_source.html">git_source</a></span><span class="op">(</span></span>
<span>    git_url <span class="op">=</span> <span class="st">"www.github.com/&lt;user&gt;/&lt;repo&gt;"</span>,</span>
<span>    git_provider <span class="op">=</span> <span class="st">"github"</span>,</span>
<span>    reference <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"branch"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># 9am every day, paused currently</span></span>
<span>  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span></span>
<span>    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,</span>
<span>    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="updating-jobs">Updating Jobs<a class="anchor" aria-label="anchor" href="#updating-jobs"></a>
</h3>
<div class="section level4">
<h4 id="partial-update">Partial Update<a class="anchor" aria-label="anchor" href="#partial-update"></a>
</h4>
<p>Jobs can be partially updated, for example to rename an existing
job:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only change the job name</span></span>
<span><span class="fu"><a href="../reference/db_jobs_update.html">db_jobs_update</a></span><span class="op">(</span></span>
<span>  job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"brickster example: renamed job"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Adding a timeout and adjusting maximum concurrent runs allowed:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adding timeout and increasing max concurrent runs</span></span>
<span><span class="fu"><a href="../reference/db_jobs_update.html">db_jobs_update</a></span><span class="op">(</span></span>
<span>  job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span>,</span>
<span>  timeout_seconds <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">5</span>,</span>
<span>  max_concurrent_runs <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can add new tasks but it may involve some extra steps,
either:</p>
<ul>
<li><p>Having <code><a href="../reference/job_task.html">job_task()</a></code> required for job defined already
within R and adding new tasks</p></li>
<li><p>Specifying all <code><a href="../reference/job_task.html">job_task()</a></code>’s again</p></li>
<li><p>Using <code><a href="../reference/db_jobs_get.html">db_jobs_get()</a></code> and parsing the returned
metadata into <code><a href="../reference/job_task.html">job_task()</a></code>’s</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="complete-update">Complete Update<a class="anchor" aria-label="anchor" href="#complete-update"></a>
</h4>
<p>A complete overwrite of a job can be done with
<code><a href="../reference/db_jobs_reset.html">db_jobs_reset()</a></code> - this allows the <code>job_id</code> to
remain constant while maintaining the historical run information with
prior settings. <code><a href="../reference/db_jobs_reset.html">db_jobs_reset()</a></code> is the same as
<code><a href="../reference/db_jobs_create.html">db_jobs_create()</a></code> except it takes one additional parameter
(<code>job_id</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="managing-jobs">Managing Jobs<a class="anchor" aria-label="anchor" href="#managing-jobs"></a>
</h3>
<p><code><a href="../reference/db_jobs_list.html">db_jobs_list()</a></code> and <code><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list()</a></code> were
covered in <a href="#job-basics">job basics</a>.</p>
<div class="section level4">
<h4 id="invocation">Invocation<a class="anchor" aria-label="anchor" href="#invocation"></a>
</h4>
<p>Jobs can be triggered by:</p>
<ul>
<li><p>Their defined schedule (see:
<code><a href="../reference/cron_schedule.html">cron_schedule()</a></code>)</p></li>
<li><p>Using <code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code> to trigger a run outside
regular schedule or on a paused job.</p></li>
<li><p>Creating a one off job run via
<code><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit()</a></code></p></li>
</ul>
<p>The only example yet to be covered is <code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code>,
it accepts parameters as named lists:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># invoke simple job example</span></span>
<span><span class="va">triggered_run</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_run_now.html">db_jobs_run_now</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">simple_task_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span></code></pre></div>
<p>Runs can also be cancelled:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cancel run whilst it is in progress</span></span>
<span><span class="fu"><a href="../reference/db_jobs_runs_cancel.html">db_jobs_runs_cancel</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">triggered_run</span><span class="op">$</span><span class="va">run_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="deletion">Deletion<a class="anchor" aria-label="anchor" href="#deletion"></a>
</h4>
<p>Jobs and runs can be deleted with <code><a href="../reference/db_jobs_delete.html">db_jobs_delete()</a></code> and
<code><a href="../reference/db_jobs_runs_delete.html">db_jobs_runs_delete()</a></code> respectively.</p>
<p>Cleaning up all jobs created in this documentation:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">simple_task_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">multitask_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/zacdav-db" class="external-link">Zac Davies</a>, <a href="https://www.linkedin.com/in/raphaelkurlansik/" class="external-link">Rafi Kurlansik</a>, <a href="https://www.databricks.com" class="external-link"><img src="https://databricks.com/wp-content/uploads/2019/12/cropped-databricks-icon-192x192.png" width="25" alt="Databricks"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
