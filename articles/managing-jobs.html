<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="brickster">
<title>Job Management • brickster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Job Management">
<meta property="og:description" content="brickster">
<meta property="og:image" content="https://zacdav-db.github.io/brickster/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brickster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cluster-management.html">Cluster Management</a>
    <a class="dropdown-item" href="../articles/managing-jobs.html">Job Management</a>
    <a class="dropdown-item" href="../articles/rmarkdown-databricks-notebook.html">Using RMarkdown as a Databricks Notebook</a>
    <a class="dropdown-item" href="../articles/setup-auth.html">Connect to a Databricks Workspace</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/zacdav-db/brickster/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="managing-jobs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Job Management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zacdav-db/brickster/blob/HEAD/vignettes/managing-jobs.Rmd" class="external-link"><code>vignettes/managing-jobs.Rmd</code></a></small>
      <div class="d-none name"><code>managing-jobs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="managing-databricks-jobs">Managing Databricks Jobs<a class="anchor" aria-label="anchor" href="#managing-databricks-jobs"></a>
</h2>
<p><a href="https://github.com/zacdav-db/brickster" class="external-link">brickster</a> provides full coverage of the Jobs REST API’s (specifically version 2.1), allowing creation of multi-task jobs via R code.</p>
<div class="section level3">
<h3 id="job-basics">Job Basics<a class="anchor" aria-label="anchor" href="#job-basics"></a>
</h3>
<p>When listing the jobs the default behaviour is to returns the first 25 jobs, to configure the number of jobs returned you can specify <code>limit</code> and <code>offset</code>.</p>
<p>The <code>expand_tasks</code> parameter will return task and cluster details for each job (default <code>FALSE)</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># list all jobs within Databricks workspace</span>
<span class="co"># can control limit, offset, and if cluster/jobs details are returned</span>
<span class="va">jobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_list.html">db_jobs_list</a></span><span class="op">(</span>limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># list all runs within a specific job</span>
<span class="va">job_runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">jobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></code></pre></div>
<p>To return the details of a specific job you can use <code><a href="../reference/db_jobs_get.html">db_jobs_get()</a></code>, this requires knowledge of the <code>job_id</code> which can be found via the user interface in Databricks or using <code><a href="../reference/db_jobs_list.html">db_jobs_list()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># details of a specific job</span>
<span class="va">job_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_get.html">db_jobs_get</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">jobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></code></pre></div>
<p>Each job has one or more tasks which may have dependence upon each other, execution of a job will flow through these tasks - this is known as a “run” of a job. Jobs can be scheduled to start a run on a particular schedule, or by a direct trigger such as <code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code>.</p>
<p>There are a number of functions that are specific to job runs execution and metadata:</p>
<table class="table">
<thead><tr class="header">
<th align="right">Purpose</th>
<th align="center">Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">Trigger new run of an existing job</td>
<td align="center"><code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code></td>
</tr>
<tr class="even">
<td align="right">List runs of a job</td>
<td align="center"><code><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Retrieve metadata for a specific job run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_get.html">db_jobs_runs_get()</a></code></td>
</tr>
<tr class="even">
<td align="right">Retrieve metadata for a specific task run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_get_output.html">db_jobs_runs_get_output()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Export code and/or dashboard for task run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_export.html">db_jobs_runs_export()</a></code></td>
</tr>
<tr class="even">
<td align="right">Delete record of a job run</td>
<td align="center"><code><a href="../reference/db_jobs_runs_delete.html">db_jobs_runs_delete()</a></code></td>
</tr>
<tr class="odd">
<td align="right">Cancel run of a job</td>
<td align="center"><code><a href="../reference/db_jobs_runs_cancel.html">db_jobs_runs_cancel()</a></code></td>
</tr>
</tbody>
</table>
<p>When using functions such as <code>db_jobs_run_get_output()</code> and <code><a href="../reference/db_jobs_runs_export.html">db_jobs_runs_export()</a></code> the required <code>run_id</code> can refer to the id of a given task. Each task within a given “run” will also have a <code>run_id</code> that can be referenced.</p>
</div>
<div class="section level3">
<h3 id="creating-jobs">Creating Jobs<a class="anchor" aria-label="anchor" href="#creating-jobs"></a>
</h3>
<p><a href="https://github.com/zacdav-db/brickster" class="external-link">brickster</a> enables creation of jobs from R, these jobs can be simple single task jobs or complex multi-task jobs with dependencies that share and re-use clusters.</p>
<div class="section level4">
<h4 id="simple-job">Simple Job<a class="anchor" aria-label="anchor" href="#simple-job"></a>
</h4>
<p>A single-task job can be created with the following components:</p>
<ul>
<li><p><code><a href="../reference/job_task.html">job_task()</a></code> which defines a singular task</p></li>
<li><p><code><a href="../reference/new_cluster.html">new_cluster()</a></code> required by <code><a href="../reference/job_task.html">job_task()</a></code>, it defines the compute specifications</p></li>
<li><p><code>*_task()</code>, one of the task functions e.g. <code><a href="../reference/notebook_task.html">notebook_task()</a></code></p></li>
</ul>
<p>Below is the creation of a simple job that runs a notebook and has a paused schedule:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define a job task</span>
<span class="va">simple_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"simple_task"</span>,
  description <span class="op">=</span> <span class="st">"a simple task that runs a notebook"</span>,
  <span class="co"># specify a cluster for the job</span>
  new_cluster <span class="op">=</span> <span class="fu"><a href="../reference/new_cluster.html">new_cluster</a></span><span class="op">(</span>
    spark_version <span class="op">=</span> <span class="st">"9.1.x-scala2.12"</span>,
    driver_node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,
    node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,
    num_workers <span class="op">=</span> <span class="fl">2</span>,
    cloud_attr <span class="op">=</span> <span class="fu"><a href="../reference/aws_attributes.html">aws_attributes</a></span><span class="op">(</span>ebs_volume_size <span class="op">=</span> <span class="fl">32</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="co"># this task will be a notebook</span>
  task <span class="op">=</span> <span class="fu"><a href="../reference/notebook_task.html">notebook_task</a></span><span class="op">(</span>notebook_path <span class="op">=</span> <span class="st">"/brickster/simple-notebook"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create job with simple task</span>
<span class="va">simple_task_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"brickster example: simple"</span>,
  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">simple_task</span><span class="op">)</span>,
  <span class="co"># 9am every day, paused currently</span>
  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span>
    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,
    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="multiple-tasks">Multiple Tasks<a class="anchor" aria-label="anchor" href="#multiple-tasks"></a>
</h4>
<p>Jobs can be extended beyond a singular task, this next example extends the simple job example by now having three tasks. Each subsequent task depends on the priors completion before it can proceed, each task also will define its own <code>new_cluster</code>.</p>
<p>Whilst this job runs the same notebook each time for the sake of example it demonstrates how to build dependencies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># one cluster definition, repeatedly use for each task</span>
<span class="va">multitask_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_cluster.html">new_cluster</a></span><span class="op">(</span>
  spark_version <span class="op">=</span> <span class="st">"9.1.x-scala2.12"</span>,
  driver_node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,
  node_type_id <span class="op">=</span> <span class="st">"m5a.large"</span>,
  num_workers <span class="op">=</span> <span class="fl">2</span>,
  cloud_attr <span class="op">=</span> <span class="fu"><a href="../reference/aws_attributes.html">aws_attributes</a></span><span class="op">(</span>ebs_volume_size <span class="op">=</span> <span class="fl">32</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># each task will run the same notebook (just for this example)</span>
<span class="va">multitask_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/notebook_task.html">notebook_task</a></span><span class="op">(</span>notebook_path <span class="op">=</span> <span class="st">"/brickster/simple-notebook"</span><span class="op">)</span>

<span class="co"># create three simple tasks that will depend on each other</span>
<span class="co"># task_a -&gt; task_b -&gt; task_c</span>
<span class="va">task_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_a"</span>,
  description <span class="op">=</span> <span class="st">"First task in the sequence"</span>,
  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>
<span class="op">)</span>

<span class="va">task_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_b"</span>,
  description <span class="op">=</span> <span class="st">"Second task in the sequence"</span>,
  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>,
  depends_on <span class="op">=</span> <span class="st">"task_a"</span>
<span class="op">)</span>

<span class="va">task_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_c"</span>,
  description <span class="op">=</span> <span class="st">"Third task in the sequence"</span>,
  new_cluster <span class="op">=</span> <span class="va">multitask_cluster</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>,
  depends_on <span class="op">=</span> <span class="st">"task_b"</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create job with multiple tasks</span>
<span class="va">multitask_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"brickster example: multi-task"</span>,
  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">task_a</span>, <span class="va">task_b</span>, <span class="va">task_c</span><span class="op">)</span>,
  <span class="co"># 9am every day, paused currently</span>
  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span>
    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,
    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="cluster-reuse">Cluster Reuse<a class="anchor" aria-label="anchor" href="#cluster-reuse"></a>
</h4>
<p>The multiple tasks example has one shortcoming - clusters are not reused between tasks and therefore each task will have to wait for another cluster to be started before its computations can begin, this will typically add a few minutes to each task.</p>
<p>It can be advantageous to reuse clusters between job tasks to avoid overhead for short lived tasks, or to share resources for tasks which are not computationally demanding.</p>
<p>This example is the same as the previous multi-task job however it now shares a single cluster for each task.</p>
<p><code>new_cluster</code> is replaced with <code>job_cluster_key</code> in each task:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create three simple tasks that will depend on each other</span>
<span class="co"># this time we will use a shared cluster to reduce startup overhead</span>
<span class="co"># task_a -&gt; task_b -&gt; task_c</span>
<span class="va">task_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_a"</span>,
  description <span class="op">=</span> <span class="st">"First task in the sequence"</span>,
  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>
<span class="op">)</span>

<span class="va">task_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_b"</span>,
  description <span class="op">=</span> <span class="st">"Second task in the sequence"</span>,
  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>,
  depends_on <span class="op">=</span> <span class="st">"task_a"</span>
<span class="op">)</span>

<span class="va">task_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/job_task.html">job_task</a></span><span class="op">(</span>
  task_key <span class="op">=</span> <span class="st">"task_c"</span>,
  description <span class="op">=</span> <span class="st">"Third task in the sequence"</span>,
  job_cluster_key <span class="op">=</span> <span class="st">"shared_cluster"</span>,
  task <span class="op">=</span> <span class="va">multitask_task</span>,
  depends_on <span class="op">=</span> <span class="st">"task_b"</span>
<span class="op">)</span></code></pre></div>
<p><code>job_clusters</code> is now defined in the <code><a href="../reference/db_jobs_create.html">db_jobs_create()</a></code> call where it accepts a named list of <code>new_clusters()</code>, we will reuse our example from earlier:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define job_clusters as a named list of new_cluster()</span>
<span class="va">multitask_job_with_reuse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_create.html">db_jobs_create</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"brickster example: multi-task with reuse"</span>,
  job_clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"shared_cluster"</span> <span class="op">=</span> <span class="va">multitask_cluster</span><span class="op">)</span>,
  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">task_a</span>, <span class="va">task_b</span>, <span class="va">task_c</span><span class="op">)</span>,
  <span class="co"># 9am every day, paused currently</span>
  schedule <span class="op">=</span> <span class="fu"><a href="../reference/cron_schedule.html">cron_schedule</a></span><span class="op">(</span>
    quartz_cron_expression <span class="op">=</span> <span class="st">"0 0 9 * * ?"</span>,
    pause_status <span class="op">=</span> <span class="st">"PAUSED"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>There can be multiple shared clusters and it may be beneficial to give some demanding tasks a larger cluster alone (or to share with other demanding tasks).</p>
</div>
<div class="section level4">
<h4 id="one-off-jobs">One-off Jobs<a class="anchor" aria-label="anchor" href="#one-off-jobs"></a>
</h4>
<p>It’s possible to create one-off jobs that do not have a schedule and only appears under the “jobs runs” tab, not “jobs”. <code><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit()</a></code> permits the use of an <code>idempotency_token</code> which can avoid re-submission of a run.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># submit a one off job run</span>
<span class="co"># reuse the simple task from first example</span>
<span class="co"># idempotency_token guarentees no additional triggers</span>
<span class="va">oneoff_job</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit</a></span><span class="op">(</span>
  tasks <span class="op">=</span> <span class="fu"><a href="../reference/job_tasks.html">job_tasks</a></span><span class="op">(</span><span class="va">simple_task</span><span class="op">)</span>,
  run_name <span class="op">=</span> <span class="st">"brickster example: one-off job"</span>,
  idempotency_token <span class="op">=</span> <span class="st">"my_job_run_token"</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="updating-jobs">Updating Jobs<a class="anchor" aria-label="anchor" href="#updating-jobs"></a>
</h3>
<div class="section level4">
<h4 id="partial-update">Partial Update<a class="anchor" aria-label="anchor" href="#partial-update"></a>
</h4>
<p>Jobs can be partially updated, for example to rename an existing job:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># only change the job name</span>
<span class="fu"><a href="../reference/db_jobs_update.html">db_jobs_update</a></span><span class="op">(</span>
  job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span>,
  name <span class="op">=</span> <span class="st">"brickster example: renamed job"</span>
<span class="op">)</span></code></pre></div>
<p>Adding a timeout and adjusting maximum concurrent runs allowed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># adding timeout and increasing max concurrent runs</span>
<span class="fu"><a href="../reference/db_jobs_update.html">db_jobs_update</a></span><span class="op">(</span>
  job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span>,
  timeout_seconds <span class="op">=</span> <span class="fl">60</span> <span class="op">*</span> <span class="fl">5</span>,
  max_concurrent_runs <span class="op">=</span> <span class="fl">2</span>
<span class="op">)</span></code></pre></div>
<p>You can add new tasks but it may involve some extra steps, either:</p>
<ul>
<li><p>Having <code><a href="../reference/job_task.html">job_task()</a></code> required for job defined already within R and adding new tasks</p></li>
<li><p>Specifying all <code><a href="../reference/job_task.html">job_task()</a></code>’s again</p></li>
<li><p>Using <code><a href="../reference/db_jobs_get.html">db_jobs_get()</a></code> and parsing the returned metadata into <code><a href="../reference/job_task.html">job_task()</a></code>’s</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="complete-update">Complete Update<a class="anchor" aria-label="anchor" href="#complete-update"></a>
</h4>
<p>A complete overwrite of a job can be done with <code><a href="../reference/db_jobs_reset.html">db_jobs_reset()</a></code> - this allows the <code>job_id</code> to remain constant while maintaining the historical run information with prior settings. <code><a href="../reference/db_jobs_reset.html">db_jobs_reset()</a></code> is the same as <code><a href="../reference/db_jobs_create.html">db_jobs_create()</a></code> except it takes one additional parameter (<code>job_id</code>).</p>
</div>
</div>
<div class="section level3">
<h3 id="managing-jobs">Managing Jobs<a class="anchor" aria-label="anchor" href="#managing-jobs"></a>
</h3>
<p><code><a href="../reference/db_jobs_list.html">db_jobs_list()</a></code> and <code><a href="../reference/db_jobs_runs_list.html">db_jobs_runs_list()</a></code> were covered in <a href="#job-basics">job basics</a>.</p>
<div class="section level4">
<h4 id="invocation">Invocation<a class="anchor" aria-label="anchor" href="#invocation"></a>
</h4>
<p>Jobs can be triggered by:</p>
<ul>
<li><p>Their defined schedule (see: <code><a href="../reference/cron_schedule.html">cron_schedule()</a></code>)</p></li>
<li><p>Using <code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code> to trigger a run outside regular schedule or on a paused job.</p></li>
<li><p>Creating a one off job run via <code><a href="../reference/db_jobs_runs_submit.html">db_jobs_runs_submit()</a></code></p></li>
</ul>
<p>The only example yet to be covered is <code><a href="../reference/db_jobs_run_now.html">db_jobs_run_now()</a></code>, it accepts parameters as named lists:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># invoke simple job example</span>
<span class="va">triggered_run</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_jobs_run_now.html">db_jobs_run_now</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">simple_task_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></code></pre></div>
<p>Runs can also be cancelled:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cancel run whilst it is in progress</span>
<span class="fu"><a href="../reference/db_jobs_runs_cancel.html">db_jobs_runs_cancel</a></span><span class="op">(</span>run_id <span class="op">=</span> <span class="va">triggered_run</span><span class="op">$</span><span class="va">run_id</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="deletion">Deletion<a class="anchor" aria-label="anchor" href="#deletion"></a>
</h4>
<p>Jobs and runs can be deleted with <code><a href="../reference/db_jobs_delete.html">db_jobs_delete()</a></code> and <code><a href="../reference/db_jobs_runs_delete.html">db_jobs_runs_delete()</a></code> respectively.</p>
<p>Cleaning up all jobs created in this documentation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">simple_task_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span>
<span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">multitask_job</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span>
<span class="fu"><a href="../reference/db_jobs_delete.html">db_jobs_delete</a></span><span class="op">(</span>job_id <span class="op">=</span> <span class="va">multitask_job_with_reuse</span><span class="op">$</span><span class="va">job_id</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/zacdav-db" class="external-link">Zac Davies</a>, <a href="https://www.linkedin.com/in/raphaelkurlansik/" class="external-link">Rafi Kurlansik</a>, <a href="https://www.databricks.com" class="external-link"><img src="https://databricks.com/wp-content/uploads/2019/12/cropped-databricks-icon-192x192.png" width="25" alt="Databricks"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
